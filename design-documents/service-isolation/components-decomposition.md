# Candidates for decomposition

The current modules implementation doesn't allow defining boundaries. A lot of modules are coupled with each other and
it's easier to define boundaries for a group of modules which should be split.

The next diagram shows Magento base components and their relations.

![Base components](img/base-components.png)

The main Magento functionality is concentrated in such components like `Catalog`, `Checkout`, `OMS`, `Customer`.
As a lot of other modules depend on it, probably, decoupling these components will cause the most BIC and will take
much time.

The second "layer" is represented by such components like `Pricing`, `Promotions`, `Inventory`, `Tax` and the general
purpose of these components - provide additional customization for business scenarios. These components are possible
candidates for the decoupling but they are tightly coupled with base components and with each other.

The components on the last layer provide the integration with 3rd party system, like `Payments` or `Shipping`
components, or provide additional functionality like `Wishlist` or `Reviews` which don't affect base functionality.
Probably, they are the best candidates for the first iteration decoupling.

## Criteria to separate

Based on discussed criteria like:

 * Strategy
 * Straight forward
 * Minimum BIC or migration path
 * Coupling to monolith
 * Value
 
The mentioned components have the following pros and cons:

|  Component |          Strategy                                                          |      Straight Forward                                                                      |           BIC                                           |               Monolith Coupling                                                    |         Value                                                       |
|:----------:|:---------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------|:--------------------------------------------------------|:-----------------------------------------------------------------------------------|:--------------------------------------------------------------------|
| Payments   | * Extract payment related domain                                           | * Extract the presentation layer                                                           | * New API might be introduced                           | * Depends on OMS and Quote modules API interfaces and the private implementation   | * Can be used as separate component not only in the scope of Magento|
|            | * Introduce API                                                            | * Split to different modules which depend on OMS, Checkout and Quote                       | * Move DB tables                                        | * Has circular dependencies                                                        |                                                                     |
|            | * Unify payment operations and separate from Sales                         | * Extract payment related code from Sales                                                  |                                                         |                                                                                    |                                                                     |
|            |                                                                            | * Split Payment module dependencies into multiple modules                                  |                                                         |                                                                                    |                                                                     |
|            |                                                                            | * Legacy implementation like AbstractMethod might be removed                               |                                                         |                                                                                    |                                                                     |
|            |                                                                            | * All infrastructure related to deprecated credit card encryption might be removed         |                                                         |                                                                                    |                                                                     |
|            |                                                                            |                                                                                            |                                                         |                                                                                    |                                                                     |
| Shipping   | * Move related logic from Sales module                                     | * Extract the presentation layer                                                           | * New API might be introduced                           | * Tightly coupled with OMS, Quote, Checkout                                        | * Can be used as separate component not only in the scope of Magento|
|            | * Unify shipping operations                                                | * Extract Payment Gateway infrastructure for re-using for shipping carriers                | * Some logic should be moved from the OMS modules       |                                                                                    |                                                                     |
|            | * Create unified infrastructure for shipping integrations                  |                                                                                            | * UI should be changed to remove hard dependency to OMS |                                                                                    |                                                                     |
|            |                                                                            | * Split existing dependencies into new modules                                             | * Move DB tables                                        |                                                                                    |                                                                     |
|            |                                                                            |                                                                                            |                                                         |                                                                                    |                                                                     |
| Wishlist   | * Introduce API                                                            | * Extract the presentation layer                                                           | * API might be introduced                               | * Coupled with Sales, Checkout, Catalog, Inventory, Customer, Theme                | * Can be removed without affecting other existing functionality     |
|            |                                                                            | * Split dependencies Refactor buy Request usage in Sales, Quote, Checkout, Catalog modules | * Move DB tables                                        |                                                                                    |                                                                     |
|            |                                                                            |                                                                                            |                                                         |                                                                                    |                                                                     |
| Reviews    | * Introduce API                                                            | * Resolve soft dependencies                                                                | * New API might be introduced                           | * Depends on Product, Catalog and EAV modules                                      |                                                                     |
|            |                                                                            | * Extract the presentation layer                                                           |                                                         |                                                                                    |                                                                     |
|            |                                                                            |                                                                                            |                                                         |                                                                                    |                                                                     |
| Tax        | * Introduce unified interface for tax calculation based on different rules | * Extract the presentation layer                                                           | * Splitting existing API and introducing new one        | * Depends on Sales, Quote Has circular dependencies                                |                                                                     |
|            | * Provide a possibility to extend and customize tax calculation            | * Extract tax calculation domain                                                           |                                                         | * Has knowledge about specific modules implementation                              |                                                                     |
|            |                                                                            | * Introduce new API and split the existing                                                 |                                                         |                                                                                    |                                                                     |
|            |                                                                            |                                                                                            |                                                         |                                                                                    |                                                                     |
| Promotions | * Introduce API and unify communication interface                          | * Extract the presentation layer                                                           | * New API might be introduced                           | * Coupled with Checkout, Sales, Quote modules                                      |                                                                     |
|            |                                                                            | * Resolve circular dependencies                                                            |                                                         |                                                                                    |                                                                     |
|            |                                                                            |                                                                                            |                                                         | * Has circular dependencies                                                        |                                                                     |
|            |                                                                            |                                                                                            |                                                         |                                                                                    |                                                                     |
| Inventory  |                                                                            | * Extract the presentation layer                                                           |                                                         | * Has circular dependencies                                                        |                                                                     |
|            |                                                                            |                                                                                            |                                                         |                                                                                    |                                                                     |
| Pricing    | * Introduce API                                                            | * Extract the presentation                                                                 |                                                         | * Depends on Quote, Catalog, different types of product                            |                                                                     |
|            |                                                                            | * Split into multiple modules                                                              |                                                         | * Has circular dependencies                                                        |                                                                     |
|            |                                                                            |                                                                                            |                                                         |                                                                                    |                                                                     |

### Payment module Dependencies

![Payment Dependencies](img/payment-dependencies.png)